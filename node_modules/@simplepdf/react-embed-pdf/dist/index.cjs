"use strict";var e=require("react"),t=require("react-dom");function n(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=n(e),o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function c(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}l((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}"function"==typeof SuppressedError&&SuppressedError,function(e){if(!e)return;if("undefined"==typeof window)return;const t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t)}(".simplePDF_container{-webkit-user-select:none;-moz-user-select:none;user-select:none;position:fixed;display:flex;box-sizing:border-box;align-items:center;justify-content:center;height:100vh;width:100%;z-index:999999;padding:16px;top:0;left:0;background:rgba(0,0,0,.5)}.simplePDF_content{width:100%;height:100%;position:relative;box-sizing:border-box}.simplePDF_iframeContainer{overflow:hidden;background:#f1f7ff;border-radius:6px;width:100%;height:100%}.simplePDF_iframe{border:none;border-radius:6px;width:100%;height:100%}.simplePDF_close{z-index:1;position:absolute;top:-12px;right:-12px;border:none;padding:6px;border-radius:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.24);cursor:pointer;background:#ff5959;text-shadow:1px 1px #243889}.simplePDF_close svg{fill:#fff;width:14px;height:14px}.simplePDF_close:hover{box-shadow:0 2px 4px rgba(0,0,0,.1),0 4px 4px rgba(0,0,0,.24)}");var c=function(){return r.createElement("svg",{height:"512",viewBox:"0 0 512 512",width:"512",xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg"},r.createElement("path",{d:"M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z"}))},l=function(e){return"inline"===e.mode},u=r.forwardRef((function(e,t){var n=e.className,i=e.style;return r.createElement("iframe",{ref:t,className:n,style:o({border:0},i)})})),s=r.forwardRef((function(e,n){var o=e.children,i=e.editorURL,a=r.useState(!1),l=a[0],u=a[1],s=r.useCallback((function(e){e.preventDefault(),u(!0)}),[]),f=r.useCallback((function(){u(!1)}),[]);return r.createElement(r.Fragment,null,l&&t.createPortal(r.createElement("div",{className:"simplePDF_container","aria-modal":"true"},r.createElement("div",{className:"simplePDF_content"},r.createElement("button",{onClick:f,className:"simplePDF_close","aria-label":"Close PDF editor modal"},r.createElement(c,null)),r.createElement("div",{className:"simplePDF_iframeContainer"},r.createElement("iframe",{ref:n,referrerPolicy:"no-referrer-when-downgrade",className:"simplePDF_iframe",src:i})))),document.body),r.cloneElement(o,{onClick:s}))}));exports.EmbedPDF=function(e){var t,n,c,f,d=e.context,p=e.companyIdentifier,m=e.locale,v=r.useState({type:null,value:null,isEditorReady:!1}),h=v[0],b=v[1],y=r.useRef(null),w=l(e)?null!==(t=e.documentURL)&&void 0!==t?t:null:null!==(f=null===(c=null===(n=e.children)||void 0===n?void 0:n.props)||void 0===c?void 0:c.href)&&void 0!==f?f:null;r.useEffect((function(){if(w){i(void 0,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:return[4,fetch(w,{method:"GET",credentials:"same-origin"})];case 1:if(!(e=r.sent()).ok)throw new Error("Failed to retrieve the document: ".concat(JSON.stringify({status:e.status,url:w})));return[4,e.blob()];case 2:return t=r.sent(),n=new FileReader,[4,new Promise((function(e,r){n.onload=e,n.onerror=r,n.readAsDataURL(t)}))];case 3:return r.sent(),[2,n.result]}}))})).then((function(e){return b((function(t){return o(o({},t),{type:"iframe_event",value:e})}))})).catch((function(){b((function(e){return o(o({},e),{type:"cors_proxy_fallback",value:w})}))}))}}),[w]);var g=r.useMemo((function(){return"https://".concat(null!=p?p:"embed",".simplepdf.eu")}),[p]);r.useEffect((function(){h.isEditorReady&&"iframe_event"===h.type&&null!==h.value&&function(e){var t=e.iframeRef,n=e.documentDataURL,r=e.editorDomain;i(void 0,void 0,void 0,(function(){var e,o,i;return a(this,(function(a){return e=new URL(r),null===(i=null===(o=t.current)||void 0===o?void 0:o.contentWindow)||void 0===i||i.postMessage(JSON.stringify({type:"LOAD_DOCUMENT",data:{data_url:n}}),e.origin),[2]}))}))}({iframeRef:y,documentDataURL:h.value,editorDomain:g})}),[h,g]);var x=r.useCallback((function(t){return i(void 0,void 0,void 0,(function(){var n,r,i,c,l,u;return a(this,(function(a){switch(a.label){case 0:if(n=new URL(t.origin).origin,r=new URL(g).origin,n!==r)return[2];if(!(t.source===(null===(l=y.current)||void 0===l?void 0:l.contentWindow)))return[2];switch(i=function(){try{return JSON.parse(t.data)}catch(e){return console.error("Failed to parse iFrame event payload"),null}}(),null==i?void 0:i.type){case"EDITOR_READY":return[3,1];case"DOCUMENT_LOADED":case"SUBMISSION_SENT":return[3,2]}return[3,6];case 1:return b((function(e){return o(o({},e),{isEditorReady:!0})})),[2];case 2:return a.trys.push([2,4,,5]),[4,null===(u=e.onEmbedEvent)||void 0===u?void 0:u.call(e,i)];case 3:return a.sent(),[3,5];case 4:return c=a.sent(),console.error("onEmbedEvent failed to execute: ".concat(JSON.stringify(c))),[3,5];case 5:case 6:return[2]}}))}))}),[e.onEmbedEvent,g]);r.useEffect((function(){return window.addEventListener("message",x,!1),function(){return window.removeEventListener("message",x)}}),[x]);var E=r.useMemo((function(){if(!d)return null;try{return encodeURIComponent(btoa(JSON.stringify(d)))}catch(e){return console.error("Failed to encode the context: ".concat(JSON.stringify(e)),{context:d}),null}}),[JSON.stringify(d)]),D=r.useMemo((function(){var e=new URL("/".concat(null!=m?m:"en","/editor"),g);return E&&e.searchParams.set("context",E),w&&e.searchParams.set("loadingPlaceholder","true"),"cors_proxy_fallback"===(null==h?void 0:h.type)&&null!==(null==h?void 0:h.value)&&e.searchParams.set("open",h.value),e.href}),[g,w,E,h,m]),P=l(e);return r.useEffect((function(){P&&y&&y.current&&(y.current.src=D)}),[D,P]),P?r.createElement(u,{className:e.className,style:e.style,ref:y}):r.createElement(s,{children:e.children,editorURL:D,ref:y})};
//# sourceMappingURL=index.cjs.map

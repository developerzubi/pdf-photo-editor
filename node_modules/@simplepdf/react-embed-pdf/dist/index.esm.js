import*as e from"react";import{createPortal as n}from"react-dom";var t=function(){return t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},t.apply(this,arguments)};function r(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,l)}c((r=r.apply(e,n||[])).next())}))}function o(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(e){l=[6,e],r=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}"function"==typeof SuppressedError&&SuppressedError,function(e){if(!e)return;if("undefined"==typeof window)return;const n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=e,document.head.appendChild(n)}(".simplePDF_container{-webkit-user-select:none;-moz-user-select:none;user-select:none;position:fixed;display:flex;box-sizing:border-box;align-items:center;justify-content:center;height:100vh;width:100%;z-index:999999;padding:16px;top:0;left:0;background:rgba(0,0,0,.5)}.simplePDF_content{width:100%;height:100%;position:relative;box-sizing:border-box}.simplePDF_iframeContainer{overflow:hidden;background:#f1f7ff;border-radius:6px;width:100%;height:100%}.simplePDF_iframe{border:none;border-radius:6px;width:100%;height:100%}.simplePDF_close{z-index:1;position:absolute;top:-12px;right:-12px;border:none;padding:6px;border-radius:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.24);cursor:pointer;background:#ff5959;text-shadow:1px 1px #243889}.simplePDF_close svg{fill:#fff;width:14px;height:14px}.simplePDF_close:hover{box-shadow:0 2px 4px rgba(0,0,0,.1),0 4px 4px rgba(0,0,0,.24)}");var i=function(){return e.createElement("svg",{height:"512",viewBox:"0 0 512 512",width:"512",xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z"}))},a=function(e){return"inline"===e.mode},l=e.forwardRef((function(n,r){var o=n.className,i=n.style;return e.createElement("iframe",{ref:r,className:o,style:t({border:0},i)})})),c=e.forwardRef((function(t,r){var o=t.children,a=t.editorURL,l=e.useState(!1),c=l[0],u=l[1],s=e.useCallback((function(e){e.preventDefault(),u(!0)}),[]),d=e.useCallback((function(){u(!1)}),[]);return e.createElement(e.Fragment,null,c&&n(e.createElement("div",{className:"simplePDF_container","aria-modal":"true"},e.createElement("div",{className:"simplePDF_content"},e.createElement("button",{onClick:d,className:"simplePDF_close","aria-label":"Close PDF editor modal"},e.createElement(i,null)),e.createElement("div",{className:"simplePDF_iframeContainer"},e.createElement("iframe",{ref:r,referrerPolicy:"no-referrer-when-downgrade",className:"simplePDF_iframe",src:a})))),document.body),e.cloneElement(o,{onClick:s}))})),u=function(n){var i,u,s,d,f=n.context,p=n.companyIdentifier,m=n.locale,v=e.useState({type:null,value:null,isEditorReady:!1}),h=v[0],b=v[1],y=e.useRef(null),w=a(n)?null!==(i=n.documentURL)&&void 0!==i?i:null:null!==(d=null===(s=null===(u=n.children)||void 0===u?void 0:u.props)||void 0===s?void 0:s.href)&&void 0!==d?d:null;e.useEffect((function(){if(w){r(void 0,void 0,void 0,(function(){var e,n,t;return o(this,(function(r){switch(r.label){case 0:return[4,fetch(w,{method:"GET",credentials:"same-origin"})];case 1:if(!(e=r.sent()).ok)throw new Error("Failed to retrieve the document: ".concat(JSON.stringify({status:e.status,url:w})));return[4,e.blob()];case 2:return n=r.sent(),t=new FileReader,[4,new Promise((function(e,r){t.onload=e,t.onerror=r,t.readAsDataURL(n)}))];case 3:return r.sent(),[2,t.result]}}))})).then((function(e){return b((function(n){return t(t({},n),{type:"iframe_event",value:e})}))})).catch((function(){b((function(e){return t(t({},e),{type:"cors_proxy_fallback",value:w})}))}))}}),[w]);var x=e.useMemo((function(){return"https://".concat(null!=p?p:"embed",".simplepdf.eu")}),[p]);e.useEffect((function(){h.isEditorReady&&"iframe_event"===h.type&&null!==h.value&&function(e){var n=e.iframeRef,t=e.documentDataURL,i=e.editorDomain;r(void 0,void 0,void 0,(function(){var e,r,a;return o(this,(function(o){return e=new URL(i),null===(a=null===(r=n.current)||void 0===r?void 0:r.contentWindow)||void 0===a||a.postMessage(JSON.stringify({type:"LOAD_DOCUMENT",data:{data_url:t}}),e.origin),[2]}))}))}({iframeRef:y,documentDataURL:h.value,editorDomain:x})}),[h,x]);var g=e.useCallback((function(e){return r(void 0,void 0,void 0,(function(){var r,i,a,l,c,u;return o(this,(function(o){switch(o.label){case 0:if(r=new URL(e.origin).origin,i=new URL(x).origin,r!==i)return[2];if(!(e.source===(null===(c=y.current)||void 0===c?void 0:c.contentWindow)))return[2];switch(a=function(){try{return JSON.parse(e.data)}catch(e){return console.error("Failed to parse iFrame event payload"),null}}(),null==a?void 0:a.type){case"EDITOR_READY":return[3,1];case"DOCUMENT_LOADED":case"SUBMISSION_SENT":return[3,2]}return[3,6];case 1:return b((function(e){return t(t({},e),{isEditorReady:!0})})),[2];case 2:return o.trys.push([2,4,,5]),[4,null===(u=n.onEmbedEvent)||void 0===u?void 0:u.call(n,a)];case 3:return o.sent(),[3,5];case 4:return l=o.sent(),console.error("onEmbedEvent failed to execute: ".concat(JSON.stringify(l))),[3,5];case 5:case 6:return[2]}}))}))}),[n.onEmbedEvent,x]);e.useEffect((function(){return window.addEventListener("message",g,!1),function(){return window.removeEventListener("message",g)}}),[g]);var E=e.useMemo((function(){if(!f)return null;try{return encodeURIComponent(btoa(JSON.stringify(f)))}catch(e){return console.error("Failed to encode the context: ".concat(JSON.stringify(e)),{context:f}),null}}),[JSON.stringify(f)]),D=e.useMemo((function(){var e=new URL("/".concat(null!=m?m:"en","/editor"),x);return E&&e.searchParams.set("context",E),w&&e.searchParams.set("loadingPlaceholder","true"),"cors_proxy_fallback"===(null==h?void 0:h.type)&&null!==(null==h?void 0:h.value)&&e.searchParams.set("open",h.value),e.href}),[x,w,E,h,m]),_=a(n);return e.useEffect((function(){_&&y&&y.current&&(y.current.src=D)}),[D,_]),_?e.createElement(l,{className:n.className,style:n.style,ref:y}):e.createElement(c,{children:n.children,editorURL:D,ref:y})};export{u as EmbedPDF};
//# sourceMappingURL=index.esm.js.map
